pkgname=mpd-custom
conflicts=("mpd")
pkgver=0.24.6
pkgrel=1
pkgdesc='Flexible, powerful, server-side application for playing music'
url='http://www.musicpd.org/'
license=('GPL')
arch=('i686' 'x86_64')
depends=('ffmpeg' 'curl'
         'sqlite' 'wavpack' 'libid3tag' 'yajl' 'libmpdclient'
         'icu' 'libsamplerate' 'libsoxr' 'fmt' 'liburing')
makedepends=('meson')
source=("https://www.musicpd.org/download/mpd/${pkgver%.*}/${pkgname%-custom}-${pkgver}.tar.xz")
sha1sums=('c54ce0ac844d61a06e2bb98865a7561a8ab56628')

build() {
  # remove ipv6 support; use ffmpeg for mp3 decoding instead of mad;
  # disable unused stuff like shout, mms, nfs and audio cd support
  cd "${pkgname%-custom}-${pkgver}"
  mkdir "bbuild" && cd "bbuild"
  arch-meson .. \
  -Ddocumentation=disabled \
  -Dhtml_manual=false \
  -Ddoxygen=false \
  -Dio_uring=enabled \
  -Dtcp=true \
  -Dipv6=disabled \
  -Ddsd=false \
  -Dupnp=disabled \
  -Dneighbor=false \
  -Dudisks=disabled \
  -Dwebdav=disabled \
  -Dcue=false \
  -Dcdio_paranoia=disabled \
  -Dcurl=enabled \
  -Dmms=disabled \
  -Dnfs=disabled \
  -Dsmbclient=disabled \
  -Dqobuz=disabled \
  -Dbzip2=disabled \
  -Diso9660=disabled \
  -Dzzip=disabled \
  -Dchromaprint=disabled \
  -Dadplug=disabled \
  -Daudiofile=disabled \
  -Dfaad=disabled \
  -Dffmpeg=enabled \
  -Dfluidsynth=disabled \
  -Dgme=disabled \
  -Dmad=disabled \
  -Dmikmod=disabled \
  -Dmodplug=disabled \
  -Dopenmpt=disabled \
  -Dmpcdec=disabled \
  -Dmpg123=disabled \
  -Dopus=disabled \
  -Dsidplay=disabled \
  -Dsndfile=disabled \
  -Dtremor=disabled \
  -Dvorbis=disabled \
  -Dwavpack=disabled \
  -Dwildmidi=disabled \
  -Dvorbisenc=disabled \
  -Dtwolame=disabled \
  -Dshine=disabled \
  -Dwave_encoder=false \
  -Dalsa=disabled \
  -Dao=disabled \
  -Dfifo=false \
  -Djack=disabled \
  -Dopenal=disabled \
  -Doss=disabled \
  -Dpipe=false \
  -Dpulse=disabled \
  -Drecorder=false \
  -Dshout=disabled \
  -Dsnapcast=false \
  -Dsndio=disabled \
  -Dsolaris_output=disabled \
  -Dexpat=disabled \
  -Dnlohmann_json=disabled \
  -Dzeroconf=disabled \
  -Dzlib=disabled \

  ninja
}

package() {
  cd "${srcdir}/${pkgname%-custom}-${pkgver}"
  cd "bbuild"
  DESTDIR="${pkgdir}" ninja install
}
